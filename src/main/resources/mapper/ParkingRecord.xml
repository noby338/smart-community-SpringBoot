<?xml version="1.0" encoding="UTF-8" ?>
<!-- XML约束头:MyBatis的约束文件使用的dtd，规范这个XML文档处理 遵守XML的一般规则以外，要遵守的自定义规则:能够使用哪些标签，使用哪些属性，出现的次数，标签的先后属性 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- mapper是映射文件的根节点 namespace属性：名称空间，命名空间.就是一个名字 现在可以任意，以后使用接口的全限定名 -->
<mapper namespace="com.woniuxy.smart_community.dao.ParkingRecordDao">
<!--查询-->
    <select id="selectParkingRecord" resultMap="parkingRecordMapper">
        select * from parking_record
        <include refid="selectParkingRecord"/>
    </select>

    <select id="selectParkingRecordNums" resultType="int">
        select count(*) from parking_order_list
        <include refid="selectParkingRecord"/>
    </select>



    
<!--添加 添加信息，可以直接过去添加信息的主键-->
    <insert id="insertParingRecordInto" parameterType="parkingOrderList"
            useGeneratedKeys="true" keyProperty="orderId" keyColumn="orderid" >
        insert into parking_record values(null,#{parkingRecord.pRecordNo},#{parkingRecord.carNo},
        #{parkingRecord.carId},#{parkingRecord.owId},#{parkingRecord.pIntime},null,null,null)
    </insert>


<!--修改-->
    <update id="updateParkingRecordOut">
        update parking_record set poutime=#{parkingRecord.pOutime},
        pcost=#{parkingRecord.pCost},paytype=#{parkingRecord.payType}
        <where>
            <if test="parkingRecord.pRecordId!=null">
                and precordid=#{parkingRecord.pRecordId}
            </if>
            <if test="parkingRecord.pRecordNo!=null and parkingRecord.pRecordNo!=''">
                and pRecordNo=#{parkingRecord.pRecordNo}
            </if>
            <if test="parkingRecord.carNo!=null and parkingRecord.carNo!=''">
                and carno=#{parkingRecord.carNo}
            </if>
        </where>
    </update>



<!--删除-->



<!--共用功能-->

    <resultMap id="parkingRecordMapper" type="parkingRecord">
        <id column="precordid" property="pRecordId"/>
        <result column="precordno" property="pRecordNo"/>
        <result column="carno" property="carNo"/>
        <result column="pintime" property="pIntime"/>
        <result column="poutime" property="pOutime"/>
        <result column="pcost" property="pCost"/>
        <result column="paytype" property="payType"/>
        <association property="carInfo" javaType="CarInfo" column="carid" select="selectCarInfoByCarId"/>
        <association property="ownersInfo" javaType="OwnersInfo" column="owid" select="selectOwnersInfoByOwid"/>
    </resultMap>
    <select id="selectCarInfoByCarId" resultType="carInfo">
        select * from car_info where carid=#{carid}
    </select>
    <select id="selectOwnersInfoByOwid" resultType="ownersInfo">
        select * from owners_info where owid=#{owid}
    </select>



    <sql id="selectParkingRecord">
        <where>
            <if test="parkingRecord.pRecordId!=null">
                and precordid=#{parkingRecord.pRecordId}
            </if>
            <if test="parkingRecord.pRecordNo!=null and parkingRecord.pRecordNO!=''">
                and precordno=#{parkingRecord.pRecordNo}
            </if>
            <if test="parkingRecord.carNo!=null and parkingRecord.carNo!=''">
                and carno=#{parkingRecord.carNo}
            </if>
            <if test="parkingRecord.owid!=null">
                and owid=#{parkingRecord.owId}
            </if>
            <if test="parkingRecord.pInTime!=null">
                and pintime <![CDATA[>=]]> #{parkingRecord.pIntime}
            </if>
            <if test="parkingRecord.pOutTime!=null">
                and poutime <![CDATA[<=]]> #{parkingRecord.pOutime}
            </if>
            <if test="parkingRecord.pCost!=null">
                and pcost=#{parkingRecord.pCost}
            </if>
            <if test="parkingRecord.payType!=null and parkingRecord.payType!=''">
                and paytype=#{parkingRecord.payType}
            </if>

        </where>
    </sql>




</mapper>
