<?xml version="1.0" encoding="UTF-8" ?>
<!-- XML约束头:MyBatis的约束文件使用的dtd，规范这个XML文档处理 遵守XML的一般规则以外，要遵守的自定义规则:能够使用哪些标签，使用哪些属性，出现的次数，标签的先后属性 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- mapper是映射文件的根节点 namespace属性：名称空间，命名空间.就是一个名字 现在可以任意，以后使用接口的全限定名 -->
<mapper namespace="com.woniuxy.smart_community.dao.OwnerInfoDao">
<!--查询-->
    <select id="selectOwnerByOwnerinfo" resultMap="ownersInfoMapper">
        select * from owners_info
        <include refid="selectOwnersinfo"/>
    </select>

    <select id="selectOwnameByOwid" resultMap="ownersInfoMapper">
        select * from owners_info o,house h where o.id=h.id and owid=#{owid}
    </select>

    <select id="selectOwnerByOwnameAndPhone" resultMap="ownersInfoMapper">
        select * from owners_info o,house h  where o.id=h.id
            <if test="owname!=null and owname!=''">
                and owname like '%' #{owName} '%'
            </if>
            <if test="owphone!=null and owname!=''">
                and owphone like '%' #{owPhone} '%'
            </if>
    </select>



    <select id="selectAll" resultMap="ownersInfoMapper">
        select * from owners_info o,house h  where o.id=h.id
    </select>



    
<!--添加-->
    <insert id="insertOwnerinfo"  parameterType="ownersinfo"
            useGeneratedKeys="true" keyProperty="owId" keyColumn="owid">
        insert into owners_info values(null,#{ownersInfo.owName},#{ownersInfo.owPhone},#{ownersInfo.id},#{ownersInfo.owType})
    </insert>


<!--修改-->
    <update id="updateOwnerByOwnerinfo">
        update owners_info set <include refid="updateOwnersinfo"/> where owid=#{ownersInfo.owId}
    </update>


<!--删除-->
    <delete id="deleteOwnerByOwid">
        delete owners_info where owid=#{owId}
    </delete>


<!--共用功能-->
    <!--联表查询-->
    <resultMap id="ownersInfoMapper" type="ownersInfo">
        <id column="owid" property="owId"/>
        <result column="owname" property="owName"/>
        <result column="owphone" property="owPhone"/>
        <result column="owtype" property="owType"/>
        <association property="house" javaType="house" column="id" select="selecctHouseById"/>
    </resultMap>
    <select id="selecctHouseById">
        select * from house where id=#{id}
    </select>


    <!--对象查询-->
    <sql id="selectOwnersinfo">

            <if test="ownersInfo.owId!=null">
                and owid=#{ownersInfo.owId}
            </if>
            <if test="ownersInfo.owName!=null and ownersInfo.owName!=''">
                and owname like '%' #{ownersInfo.owName} '%'
            </if>
            <if test="ownersInfo.owPhone!=null and ownersInfo.owPhone!=''">
                and owphone like '%' #{ownersInfo.owPhone}
            </if>
            <if test="ownersInfo.owType!=null">
                and owtype like '%' #{ownersInfo.owType} '%'
            </if>
            <if test="ownersInfo.id!=null and ownersInfo.id!=''">
                and id=#{ownersInfo.id}
            </if>

    </sql>

    <!--对象属性修改-->
    <sql id="updateOwnersinfo">
            <if test="ownersInfo.owName!=null and ownersInfo.owName!=''">
                owname=#{ownersInfo.owName}
            </if>
            <if test="ownersInfo.owPhone!=null and ownersInfo.owPhone!=''">
                ,owphone=#{ownersInfo.owPhone}
            </if>
            <if test="ownersInfo.owType!=null and ownersInfo.owType!=''">
                ,owtype=#{ownersInfo.owType},
            </if>
            <if test="ownersInfo.id!=null and ownersInfo.id!=''">
                ,id=#{ownersInfo.id}
            </if>

    </sql>

</mapper>
